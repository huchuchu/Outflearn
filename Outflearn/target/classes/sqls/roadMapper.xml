<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="road">

<insert id="roadmapInsert" parameterType="roadMapDto">
INSERT INTO ROADMAP_INFO 
VALUES(ROADMAP_SQ.NEXTVAL, #{user_num}, #{roadmap_title}, #{roadmap_content}, #{roadmap_subscribe}, #{roadmap_like}, #{roadmap_share}, #{main_num})
</insert>

<select id="selectSQ" resultType="int">
SELECT ROADMAP_SQ.CURRVAL FROM DUAL
</select>

<insert id="roadNclass" parameterType="java.util.Map">
<foreach collection="staffList" item="item" open="INSERT ALL" separator=" " close="SELECT * FROM DUAL" index="i">
INTO ROADMAP_CON
VALUES (#{item},#{seq},#{i}+1)
</foreach>
</insert>

<select id="mainStreamList" resultType="com.outflearn.Outflearn.dto.MainStreamDto">
SELECT * FROM MAIN_STREAM
</select>

<select id="subStramList" resultType="com.outflearn.Outflearn.dto.SubStreamDto">
SELECT * FROM SUB_STREAM 
</select>


<select id="classInfoList" resultType="ClassInfoDto" parameterType="map">
SELECT * FROM CLASS_INFO	
	<trim prefix="WHERE" prefixOverrides="AND|OR">
		<foreach collection="itemList" item="item">
			<if test="#{item} !=null">
				OR CLASS_NUM IN (SELECT CLASS_NUM FROM CLASS_CATEGORY WHERE SUB_NUM=#{item})
			</if>
		</foreach>
	</trim>	
</select>

<select id="roadMapList" resultType="RoadMapDto">
SELECT * FROM ROADMAP_INFO
</select>

<select id="selectOneRoadMap" parameterType="String" resultType="RoadMapDto">
SELECT * FROM ROADMAP_INFO WHERE ROADMAP_NUM=#{roadNum}
</select>

<select id="roadMapConlist" parameterType="String" resultType="com.outflearn.Outflearn.dto.RoadMapCon">
SELECT * FROM ROADMAP_CON WHERE ROADMAP_NUM=#{roadNum} ORDER BY ROADMAP_CUE
</select>

<select id="RoadClassInfoList" resultType="ClassInfoDto" parameterType="map">
SELECT * FROM CLASS_INFO WHERE CLASS_NUM IN
	<foreach collection="roadClassList" item="item" open="(" separator="," close=")">
		#{item}
	</foreach>
</select>


<insert id="roadMapSubscribeInsert" parameterType="map" >
INSERT INTO ROADMAP_SUBSCRIBE VALUES(#{userNum},#{roadNum})
</insert>

<update id="updatesubScribe" parameterType="String">
UPDATE ROADMAP_INFO SET ROADMAP_SUBSCRIBE = ROADMAP_SUBSCRIBE+1 WHERE ROADMAP_NUM =#{roandNum}

</update>

</mapper>