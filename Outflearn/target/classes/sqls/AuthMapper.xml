<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="auth">

   
   <!--SELECT * FROM CLASS_DATA, CLASS_INFO WHERE CLASS_INFO.CLASS_NUM = CLASS_DATA.CLASS_NUM; -->
   
   <!-- <resultMap type="ClassDataDto" id="ClassDataDto">
   	  <result column="CLASS_NUM" property="class_num" />
   	  <result column="DATA_DATA" property="data_data" />
   </resultMap>
   
   <resultMap type="ClassInfoDto" id="ClassInfoDto">
      <result column="CLASS_NUM" property="class_num" />
      <result column="CLASS_TITLE" property="class_title" />
      <result column="CLASS_AUTHOR" property="class_author" />
      <result column="CLASS_INTRO" property="class_intro" />
      <result column="CLASS_STUDENTLEVEL" property="class_studentlevel" />
      <result column="CLASS_CATEGORY" property="class_category" />
      <collection property="classdataDto" resultMap="ClassDataDto">
   </resultMap> -->
   
   <select id="classinfoselectlist" resultType="ClassInfoDto">
      SELECT * FROM CLASS_INFO
   </select>
   
   <select id="classinfoselectone" parameterType="map" resultType="ClassInfoDto">
   	  SELECT * FROM CLASS_INFO WHERE CLASS_NUM = #{class_num}
   </select>
   
   <select id="classdataselectone" parameterType="map" resultType="ClassDataDto">
	  SELECT DATA_DATA FROM CLASS_DATA WHERE CLASS_NUM = #{class_num}
   </select>
   
   <insert id="classdatainsert" parameterType="ClassDataDto">
      INSERT INTO CLASS_DATA VALUES(CLASS_DATA_SQ.NEXTVAL, #{data_subhead }, #{data_sq }, #{data_title }, #{data_data })
   </insert>
   
   <insert id="ClassInfoDtoInsert" parameterType="ClassInfoDto">
      INSERT INTO CLASS_INFO VALUES(CLASS_INFO_SQ.NEXTVAL, #{class_title }, #{class_author }, #{class_intro }, #{class_rating }, #{class_price }, 0, #{class_studentlevel }, #{class_category })
   </insert>
   
<select id="selectUser" resultType="java.util.Map">
	SELECT
		USER_ID as username,
		USER_PW as password,
		USER_ENABLED as enabled,
		USER_AUTHORITY as authority,
		USER_NUM, USER_NAME, USER_NICKNAME, USER_EMAIL 
	FROM USER_INFO
	WHERE USER_ID=#{user_id}	
</select>

<insert id="insertUser" parameterType="map">
	INSERT INTO USER_INFO
	VALUES(USER_INFO_SQ.NEXTVAL, #{user_id}, #{user_pw}, #{user_name}, #{user_nickname}, 'ROLE_USER', #{user_email}, 1)
</insert>

<!-- 회원가입 및 체크 -->
	<insert id="memberRegister" parameterType="UserInfoDto">
		INSERT INTO USER_INFO 
		VALUES(USER_INFO_SQ.NEXTVAL, #{user_id}, #{user_pw}, #{user_name}, #{user_nickname}, 'ROLE_USER', #{user_email},1)
	</insert>
	<select id="loginChk" parameterType="map" resultType="UserInfoDto">
		SELECT * FROM USER_INFO WHERE USER_ID = #{id} AND USER_PW = #{pw}
	</select>
	<select id="idChk" parameterType="map" resultType="UserInfoDto">
		SELECT * FROM USER_INFO WHERE USER_ID =#{userId}
	</select>
	<select id="nickChk" parameterType="map" resultType="UserInfoDto">
		SELECT * FROM USER_INFO WHERE USER_NICKNAME = #{nickname}
	</select>
	<select id="loginChkSns" parameterType="map" resultType="UserInfoDto">
		SELECT * FROM USER_INFO WHERE USER_ID = #{id}
	</select>
		
	<!-- 이름으로 이메일 가져오기(아이디) -->
	<select id="bringByname" parameterType="map" resultType="UserInfoDto">
		SELECT * FROM USER_INFO WHERE USER_NAME = #{name} AND USER_NICKNAME = #{nickname}
	</select>
	<!-- 이름으로 이메일 가져오기(패스워드) -->
	<select id="bringByid" parameterType="map" resultType="UserInfoDto">
		SELECT * FROM USER_INFO WHERE USER_NAME = #{name} AND USER_ID = #{id}
	</select>
	<!-- 임시비밀번호로 바꾸기 -->
	<update id="changePw" parameterType="UserInfoDto">
		UPDATE USER_INFO SET USER_PW = #{pw} WHERE USER_ID = #{id}
	</update>



</mapper>